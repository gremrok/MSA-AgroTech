@startuml Контекстная диаграмма C4 - Альтернативное решение (Модуль IoT-платформы)
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Context.puml

Title Контекстная диаграмма C4 - Альтернативное решение (Модуль IoT-платформы)

Person(дежурный, "Дежурный")
Person(инженер, "Инженер")
Person(аналитик, "Аналитик")

System_Boundary(расширенная_платформа, "Расширенная цифровая платформа «АгроТех Х»") {
    System(веб_портал_агро, "Веб-портал АгроПром Х", "Расширен: добавлен раздел по животноводству")
    System(iot_платформа, "Единая IoT-платформа", "Расширена: новый коннектор для животноводческих датчиков и камер")
    System(центральный_kafka, "Центральная шина данных (Kafka)")
    System(центральное_хранилище, "Центральное хранилище данных")
    System(единый_bi, "Единая BI-система")
    System(erp_1c, "ERP система (1С:Агро)")

    ' Новый модуль внутри границы
    System(модуль_аналитики_животных, "Модуль видеоаналитики животных", "Облачный микросервис для обработки видеостримов с ферм")
}

System_Boundary(на_ферме, "Оборудование на ферме") {
    System(шлюз_фермы, "Шлюз фермы", "Сбор данных, буферизация, пересылка сырых видеопотоков в облако")
    System(edge_устройства, "Камеры и датчики", "Те же устройства, но с минимальной локальной логикой")
}

' Связи
Rel(дежурный, веб_портал_агро, "Использует общий портал", "HTTPS")
Rel(инженер, шлюз_фермы, "Обслуживает", "Локальная сеть")

Rel(edge_устройства, шлюз_фермы, "Передает сырые данные", "Локальная сеть")
Rel(шлюз_фермы, iot_платформа, "Отправляет все данные в облако", "HTTPS/MQTT (с буфером)")
Rel(шлюз_фермы, модуль_аналитики_животных, "Стриминг видео для анализа", "RTSP/WebRTC over VPN")

Rel(iot_платформа, центральный_kafka, "Публикует события", "Kafka Protocol")
Rel(модуль_аналитики_животных, центральный_kafka, "Публикует события и результаты анализа", "Kafka Protocol")
Rel(центральный_kafka, центральное_хранилище, "Наполнение данными", "ETL")
Rel(центральное_хранилище, единый_bi, "Источник данных", "ODBC/SQL")

Rel(модуль_аналитики_животных, веб_портал_агро, "Отправляет тревоги и метаданные видео", "WebSocket/API")
Rel(iot_платформа, веб_портал_агро, "Предоставляет данные датчиков", "API")
Rel(аналитик, единый_bi, "Анализирует")

@enduml